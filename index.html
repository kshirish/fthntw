<!DOCTYPE html>
<html>
	<head>
		<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<style>
			[ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
			  display: none !important;
			}
			.chip {
				cursor: pointer;
			}
			.chip.selected {
				background-color: #26a69a;
				color: #fff; 
			}
		</style>
	</head>
	<body ng-app="fthntw">

		<div class="container" ng-controller="PageController" ng-cloak>
			<div class="row">
				<div class="col s12">
					<h1>Films that Harish needs to watch!</h1>
				</div>
				<div class="col s12">
					<div class="chip" ng-click="genreClick(item.genre)" ng-class="{selected: item.genre === selectedGenre}" ng-repeat="item in items">{{item.genre}}</div>
				</div>
				<div class="col s12">
					<ul class="collection with-header" ng-repeat="item in items | filter : { genre : selectedGenre }">
				        <li class="collection-header"><h4>{{item.genre}}</h4></li>
				        <li class="collection-item" ng-repeat="film in item.films">
				        	<p>
				        		<input type="checkbox" ng-model="film.ischecked" id="{{$index}}"/>
				        		<label for="{{$index}}" ng-click="filmClick(film)">{{film.value}}</label>
				        	</p>
				        </li>
				    </ul>
				</div>
			</div>
		</div>

		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js"></script>
		<script>

			function getLocal(key) {
				return JSON.parse(localStorage.getItem('watched') || '[]');
			}

			function setLocal(key, arr) {
				localStorage.setItem(key, JSON.stringify(arr));
				return arr;
			}

			var watched = getLocal('watched'); 

			angular.module('fthntw', [])
				.controller('PageController', ['$scope', function($scope) {
					
					var i, j;

					$scope.selectedGenre = 'All';

					$scope.items = [{
						genre: 'All',
						films: [
							{value: 'American History X'},
							{value: 'Detachment'},
							{value: 'Stuart - A Life Backwards'},
							{value: 'Blue'},
							{value: 'Red'},
							{value: 'White'},
							{value: 'The Pianist'},
							{value: 'Warrior'},
							{value: 'One Flew Over the Cuckoo\'s Nest'},
							{value: 'Leon - The professional'},
							{value: 'American Psycho'},
							{value: 'The Intouchables'},
							{value: 'The Lives of the Others'},
							{value: 'Whiplash'},
							{value: 'Memento'},
							{value: 'Reservior Dogs'},
							{value: 'The Revenant'},
							{value: 'Inglorious Bastards'},
							{value: 'The Hateful Eight'},
							{value: 'Taxi Driver'},
							{value: 'Scarface'},
							{value: 'The Hunt'},
							{value: 'A Serious Man'},
							{value: 'Network'},
							{value: 'Gandhi'},
							{value: 'Before Sunrise'},
							{value: 'Before Midnight'},
							{value: 'Before Sunset'},
							{value: 'Boyhood'},
							{value: 'Harsh Times'},
							{value: '21 Grams'}
						]
					}, {
						genre: 'Drama',
						films: [													
							{value: 'American History X'},
							{value: 'Detachment'},
							{value: 'Stuart - A Life Backwards'},
							{value: 'Blue'},
							{value: 'Red'},
							{value: 'White'},
							{value: 'The Pianist'},
							{value: 'Warrior'},
							{value: 'One Flew Over the Cuckoo\'s Nest'},
							{value: 'Leon - The professional'},
							{value: 'American Psycho'},
							{value: 'The Intouchables'},
							{value: 'The Lives of the Others'},
							{value: 'Whiplash'},
							{value: 'Memento'},
							{value: 'Reservior Dogs'},
							{value: 'The Revenant'},
							{value: 'Inglorious Bastards'},
							{value: 'The Hateful Eight'},
							{value: 'Taxi Driver'},
							{value: 'Scarface'},
							{value: 'The Hunt'},
							{value: 'A Serious Man'},
							{value: 'Network'},
							{value: 'Gandhi'},
							{value: 'Before Sunrise'},
							{value: 'Before Midnight'},
							{value: 'Before Sunset'},
							{value: 'Boyhood'},
							{value: 'Harsh Times'},
							{value: '21 Grams'}
						]
					}, {
						genre: 'Romance',
						films: [
							{value: 'Before Sunrise'},
							{value: 'Before Midnight'},
							{value: 'Before Sunset'}
						]
					}, {
						genre: 'Biography',
						films: [
							{value: 'Stuart - A Life Backwards'},
							{value: 'The Pianist'},
							{value: 'Gandhi'},
							{value: 'The Revenant'}
						]
					}, {
						genre: 'Thriller',
						films: [
							{value: 'American History X'},
							{value: 'Leon - The professional'},
							{value: 'American Psycho'},
							{value: 'Memento'},
							{value: 'Reservior Dogs'},
							{value: 'The Revenant'},
							{value: 'Inglorious Bastards'},
							{value: 'The Hateful Eight'},
							{value: 'Taxi Driver'},
							{value: 'Scarface'},
							{value: 'The Hunt'},							
							{value: 'Harsh Times'}
						]
					}, {
						genre: 'Documentry',
						films: []
					}];					

					for (i = 0; i < $scope.items.length; i++) {
						
						for (j = 0; j < $scope.items[i].films.length; j++) {

							if(watched.indexOf($scope.items[i].films[j].value) !== -1)
								$scope.items[i].films[j].ischecked = true;
						}
					}

					$scope.genreClick = function(genre) {
						$scope.selectedGenre = genre;
					};

					$scope.filmClick = function(film) {

						if(film.ischecked)						
							watched = watched.filter(function(item) {return item !== film.value});						
						else						
							if(watched.indexOf(film) === -1)
								watched.push(film.value);		

						setLocal('watched', watched);	
					};
				}]);
		</script>
	</body>
</html>
